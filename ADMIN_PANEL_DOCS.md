# Документация админ-панели EduPoint

## Обзор функционала

Полная админ-панель для управления платформой EduPoint с расширенными возможностями.

## Доступ

**URL**: `/admin/dashboard`

**Требования**: Пользователь с ролью `admin`

## Разделы админ-панели

### 1. Dashboard (Главная)
- **URL**: `/admin/dashboard`
- **Возможности**:
  - Просмотр общей статистики (пользователи, курсы, записи, сертификаты)
  - График регистраций за последние 7 дней (Chart.js)
  - Топ-5 популярных курсов
  - Список последних зарегистрированных пользователей
  - Последние заявки с контактной формы

### 2. Пользователи
- **URL**: `/admin/users`
- **Возможности**:
  - Просмотр всех пользователей
  - Изменение ролей (student, teacher, admin)
  - Удаление пользователей

### 3. Курсы
- **URL**: `/admin/courses`
- **Возможности**:
  - Просмотр всех курсов
  - Удаление курсов
  - Просмотр статистики по курсам

### 4. Заявки (Contact Messages)
- **URL**: `/admin/messages`
- **Возможности**:
  - Просмотр всех заявок с контактной формы
  - Фильтрация по статусу (new, in_progress, resolved, closed)
  - Изменение статуса заявки
  - Просмотр деталей заявки: `/admin/messages/{id}`
  - Отправка ответа на заявку (сохраняется в БД)
  - Визуальная подсветка новых заявок

**Статусы заявок**:
- `new` - Новая (желтый badge)
- `in_progress` - В работе (синий badge)
- `resolved` - Решена (зеленый badge)
- `closed` - Закрыта (серый badge)

### 5. Отзывы (Reviews)
- **URL**: `/admin/reviews`
- **Возможности**:
  - Просмотр всех отзывов
  - Удаление отзывов
  - Просмотр рейтинга и комментария
  - Ссылка на курс и профиль студента

### 6. Статистика (Statistics)
- **URL**: `/admin/statistics`
- **Возможности**:
  - Детальная статистика по всем разделам
  - **График регистраций** за последние 30 дней (линейный)
  - **График записей на курсы** за последние 30 дней (столбчатый)
  - **Топ-10 популярных курсов** с рейтингами
  - **Распределение пользователей по ролям** (круговая диаграмма)
  - **Активность по дням недели** (радар-диаграмма)
  - **Последняя активность** - 10 последних действий

### 7. Настройки (Settings)
- **URL**: `/admin/settings`
- **Возможности**: Редактирование всех настроек платформы

#### Группы настроек:

**Общие настройки (General)**:
- Название сайта
- Описание сайта
- Email администратора
- Email для контактов
- Телефон
- Адрес

**Главная страница (Homepage)**:
- Заголовок Hero-секции
- Подзаголовок Hero-секции
- Текст кнопки
- Показывать статистику (Да/Нет)
- Показывать популярные курсы (Да/Нет)
- Количество популярных курсов (3-12)

**Страница "О нас" (About)**:
- Заголовок
- Описание
- Наша миссия
- Наше видение

**Контакты и соцсети (Contact)**:
- Facebook URL
- Instagram URL
- Twitter URL
- LinkedIn URL
- YouTube URL
- Telegram
- WhatsApp

## База данных

### Таблица `contact_messages`
```sql
- id (bigint)
- name (varchar 255)
- email (varchar 255)
- subject (varchar 255)
- message (text)
- status (enum: new, in_progress, resolved, closed)
- admin_reply (text, nullable)
- replied_at (timestamp, nullable)
- created_at, updated_at
```

### Таблица `settings`
```sql
- id (bigint)
- key (varchar 255, unique)
- value (text)
- type (varchar: text, textarea, boolean, number, image)
- group (varchar: general, homepage, about, contact)
- created_at, updated_at
```

## Модели

### ContactMessage
**Файл**: `app/Models/ContactMessage.php`

**Методы**:
- `isNew()` - Проверка, является ли заявка новой
- `markAsReplied()` - Отметить как отвеченную

### Setting
**Файл**: `app/Models/Setting.php`

**Статические методы**:
- `Setting::get($key, $default = null)` - Получить значение настройки (с кешем)
- `Setting::set($key, $value, $type = 'text', $group = 'general')` - Установить настройку
- `Setting::getGroup($group)` - Получить все настройки группы

**Кеширование**: Настройки кешируются на 60 минут

## Технологии

- **Backend**: Laravel 11.x, PHP 8+
- **Frontend**: Bootstrap 5, Bootstrap Icons
- **Графики**: Chart.js 4.4.0
- **База данных**: MySQL 5.7+

## Использование настроек в Blade

```php
@php
    $siteName = Setting::get('site_name', 'EduPoint');
    $heroTitle = Setting::get('hero_title');
    $homepageSettings = Setting::getGroup('homepage');
@endphp

<h1>{{ $siteName }}</h1>
```

## Сидер настроек

Для заполнения начальными значениями:
```bash
php artisan db:seed --class=SettingsSeeder
```

## Маршруты

```php
// Заявки
GET    /admin/messages                   - Список заявок
GET    /admin/messages/{message}         - Детали заявки
PUT    /admin/messages/{message}/status  - Изменить статус
POST   /admin/messages/{message}/reply   - Отправить ответ

// Отзывы
GET    /admin/reviews                    - Список отзывов

// Настройки
GET    /admin/settings                   - Форма настроек
POST   /admin/settings                   - Сохранить настройки

// Статистика
GET    /admin/statistics                 - Детальная статистика
```

## Безопасность

- Все методы контроллера проверяют роль администратора через `auth()->user()->isAdmin()`
- При отсутствии прав возвращается 403 ошибка
- CSRF защита на всех формах

## Особенности

1. **Flash-сообщения**: Автоматическое закрытие через 5 секунд
2. **Responsive дизайн**: Адаптивная боковая панель
3. **Pagination**: Пагинация для больших списков (20 записей на страницу)
4. **Интерактивные графики**: Chart.js с анимацией
5. **Inline редактирование**: Изменение статуса заявок без перехода на другую страницу
6. **Кеширование**: Настройки кешируются для быстрого доступа

## TODO (Возможные улучшения)

- [ ] Экспорт статистики в Excel/PDF
- [ ] Email-уведомления при новых заявках
- [ ] Массовые действия (удаление, изменение статуса)
- [ ] Загрузка логотипа/изображений в настройках
- [ ] История изменений настроек
- [ ] Права доступа на уровне разделов
